accounting.settings={number:{precision:2,thousand:".",decimal:","}};var numform=accounting.formatNumber.bind(accounting);function showModal(){$("#info-modal").modal()}function betreuungszeitenAnzeigen(){$("div.einKind").show();switch(+$(".kinderzahl input:radio:checked").val()){case 3:$("div.dreiKinder").show();$("div.zweiKinder").show();break;case 2:$("div.dreiKinder").hide();$("div.zweiKinder").show();break;case 1:$("div.dreiKinder").hide();$("div.zweiKinder").hide();break}}function einkommenHinzufügen(e,n,r){var i=$(".einkommen-template").clone();i.removeClass("einkommen-template");if(n){i.find("select.einkommensart").val(n)}if(r){console.log("Höhe".höhe);i.find('input[name="höhe"]').val(r)}$(".einkommensliste").append(i)}function removeEinkommen(e){$(e.currentTarget).parents(".eintrag").remove()}function berechnen(){var e=Vorbereitung(),n=Verarbeitung(e,Parameter.Neu),r=Verarbeitung(e,Parameter.Alt);LokalSpeichern(e);$("#resultNeu").html(n.text);$("#resultAlt").html(r.text);$("#gebühr").html(GebührText(n.gebühr,r.gebühr));$(".berechnungsTab").tab();$(".berechnung").show();$(".gebuehreninfo").show()}function Vorbereitung(){var e=[],n=$(".eintrag").not(".einkommen-template");for(var r=0;r<n.length;r++){e[r]={"Höhe":+n.eq(r).find('input[name="höhe"]').val().replace(".","").replace(",","."),Art:+n.eq(r).find("select.einkommensart").val()}}var i=[],t=+$(".kinderzahl input:radio:checked").val(),o=$('input[name="zeit"]'),a=+$(".kinderzahl input:radio:checked").val();for(r=0;r<a;r++){i[r]=+o.eq(r).val()||9}return{Betreuungszeiten:i,Einkommen:e}}function Verarbeitung(e,n){var r="",i="",t,o=0,a,m,s,l=0,u="        ---------------------------------------<br>";r+="<em>1) zu berücksichtigtigendes, bereinigtes Einkommen</em><br>";r+="        Angegeben      Pauschale      Bereinigt<br>";for(var h=0,c=e.Einkommen.length;h<c;h++){t=(1-e.Einkommen[h].Art/100)*e.Einkommen[h].Höhe;o+=t;r+=sprintf("        %9s €       - %2d %%    %9s €<br>",numform(e.Einkommen[h].Höhe),e.Einkommen[h].Art,numform(t))}r+=u;r+=sprintf("        <strong>Gesamt</strong>:                     %9s €<br>",numform(o));r+="<br>";r+="<em>2) anzurechnendes Einkommen</em><br>";if(o>n.maximalEinkommen){o=n.maximalEinkommen;i="Max. Einkommen"}else{i="zu berücksichtigend"}r+=sprintf("        %-19s         %9s €<br>",i,numform(o));for(h=0,c=e.Betreuungszeiten.length;h<c;h++){o-=n.Freibeträge[h];r+=sprintf("        Freibetrag %d. Kind         - %8s €<br>",h+1,accounting.formatNumber(n.Freibeträge[h]))}r+=u;r+=sprintf("        <strong>Gesamt</strong>:                     %9s €<br>",numform(o));r+="<br>";if(n.minAnrechenbar&&o<n.minAnrechenbar){r+="        Das anrechenbare Einkommen liegt nicht<br>";r+=sprintf("        über dem Mindesteinkommen von %s €,<br>",numform(n.minAnrechenbar));r+="        es wird keine Gebühr erhoben!<br>";return{text:r,"gebühr":0}}r+="<em>3) Grundgebühr</em><br>";a=n.Gebührensatz/100*o;r+=sprintf("         %2d %%                       %9s €<br>",n.Gebührensatz,numform(a));r+="<br>";r+="<em>4) tatsächliche Gebühr</em><br>";r+="        BetrZeit    BerückAbweichung     Gebühr<br>";for(h=0,c=e.Betreuungszeiten.length;h<c;h++){s=(e.Betreuungszeiten[h]/9-1)*n.BetreuungsDifferenzFaktor;m=a+s*a;l+=m;r+=sprintf("        %4.1f h      %s %5s %%       %9s €<br>",e.Betreuungszeiten[h],s>=0?" ":"-",numform(Math.abs(s*100,{precision:1})),numform(m))}r+=u;r+=sprintf("        <strong>Gesamt</strong>:                     %9s €<br>",numform(l));r+="<br>";if(l<10){r+="        <em>KiTa-Gebühren unter 20,00 € werden nicht erhoben.</em><br>";l=0}else{r+=sprintf("        erhobene Gebühr:               <strong>%3d</strong>.00 €<br>",Math.round(l));r+="        <em>(kaufmännisch gerundet)</em><br>"}return{text:r,"gebühr":Math.round(l)}}function GebührText(e,n){if(e==n){return sprintf("Die berechnete Gebühr bleibt bei <strong>%d<strong> €",e)}return sprintf("Die berechnete Gebühr beträgt <strong>%d</strong> €. <small>Das ist eine <em>%s</em> um <strong>%d</strong> €"+" (%d %%) gegenüber der alten Gebühr von %d €</small>.",e,e>n?"Erhöhung":"Verringerung",Math.abs(e-n),Math.round(Math.abs(e-n)/n*100),n)}function LokalSpeichern(e){if(!window.localStorage){return}window.localStorage.setItem("Betreuungszeiten",JSON.stringify(e.Betreuungszeiten));window.localStorage.setItem("Einkommen",JSON.stringify(e.Einkommen))}function LokalLaden(){if(!window.localStorage){return}var e=JSON.parse(window.localStorage.Betreuungszeiten),n=JSON.parse(window.localStorage.Einkommen);if(!e||!n){return false}zeiten=$('input[name="zeit"]');for(var r=0,i=e.length;r<i;r++){if(e[r]!=9){zeiten.eq(r).val(e[r])}}$('input[name="kinderzahl"][value="'+i+'"]').click();template=$(".einkommen-template");for(r=0,i=n.length;r<i;r++){einkommenHinzufügen(null,n[r].Art,n[r].Höhe)}return true}function LokalLoeschen(){window.localStorage.setItem("Betreuungszeiten",null);window.localStorage.setItem("Einkommen",null);window.alert("Daten gelöscht")}function maillink(){var e="rIwi1ri@NoJ3W1i7.R9",n="4hI3QDaUx2HtqEWTm9GLJgKM61cv5dinkfYSOs8AzCZb0opBRNwrPjXFylu7eV",r=e.length,i="";for(var t=0,o=e.length;t<o;t++){if(n.indexOf(e.charAt(t))==-1){ltr=e.charAt(t);i+=ltr}else{ltr=(n.indexOf(e.charAt(t))-r+n.length)%n.length;i+=n.charAt(ltr)}}return i}function main(){$("#info").click(showModal);$(".kinderzahl input:radio").change(betreuungszeitenAnzeigen);$("#einkommenHinzufügen").click(einkommenHinzufügen);$(".einkommensliste").on("click","button.removeEinkommen",removeEinkommen);$("#calc").click(berechnen);$("#datenLoeschen").click(LokalLoeschen);if(LokalLaden()){berechnen()}$("#email").attr("href","mailto:"+maillink())}$(main);